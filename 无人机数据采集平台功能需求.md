## 一、平台需求说明书（缩略版结构）

### 1. 项目概述

**1.1 项目名称**
无人机环境监测数据采集与分析平台

**1.2 建设目标**

* 面向林业、森林火情、城市热岛、空气质量、土地利用变化等空中可监测场景；
* 通过无人机挂载多种传感器（多光谱、热成像、气体/颗粒物、可见光）采集数据；
* 构建一个统一的数据采集与分析平台，实现：

  * 无人机任务管理与航线下发
  * 实时遥测/传感器数据上报与可视化
  * 异常自动识别与告警
  * 历史数据管理与对比分析

**1.3 使用角色**

* 环保局人员：日常监测、预警处置、查看报表；
* 科研人员：分析历史数据、导出数据用于建模和论文；
* 系统运维/管理员：设备接入审核、账号/权限配置、系统监控；
* 第三方合作单位（可选）：通过 API 接收数据用于本地模型训练。

---

### 2. 系统总体功能

可画一个简单模块图（文字描述就行）：

* 无人机接入与协议模块
* 任务与航线管理模块
* 实时监测与预警模块
* 传感器数据管理模块
* 分析与可视化模块
* 用户与权限管理模块
* 系统管理模块

---

### 3. 详细功能需求

#### 3.1 无人机接入与管理模块

* **无人机注册管理**

  * 录入/审核无人机信息：编号、机型、载荷类型（可挂哪些传感器）、通信模块（4G/5G/WiFi）。
  * 管理无人机状态：在线/离线、维护中、禁飞。
  * 记录硬件配置（飞控型号、固件版本、最大航时、最大航高）及证照信息，支持附件上传。
  * 支持审批流程：运营人员录入→技术审核协议兼容性→管理员批准后才能接入。
  * 支持批量导入或 API 注册，避免大量手工操作。

* **在线状态与遥测监控**

  * 实时显示无人机位置（经纬度、高度）、航向、速度、电量、链路质量。
  * 支持在线无人机列表与地图视图联动。
  * 支持状态订阅：按区域/任务筛选无人机，地图上区别高风险状态（低电量、信号弱）。
  * 维护实时连接监控面板：显示心跳延迟、重试次数，异常时推送至运维。

* **无人机–平台协议适配**

  * 支持基于统一协议的心跳、遥测、传感器数据、图像元数据上报。
  * 断线重连与消息重发机制（在协议规范里细化）。
  * 提供 SDK/参考实现，封装鉴权、加密、数据压缩。
  * 兼容 HTTP(S) Pull/Push 与 MQTT/WebSocket，便于不同通信模组接入。

> 和“协议部分”的联系：这里明确平台要“会说什么话”，后面协议规范就是把每一句话定义成消息格式。

---

#### 3.2 任务与航线管理模块

* **任务建模**

  * 支持创建任务：任务类型（林业健康、火情巡查、热岛监测、空气质量剖面、土地变化复拍）。
  * 设置任务区域（在地图上画多边形/折线）、高度、速度、采样周期、使用的传感器组合。
  * 支持任务模板：按场景预置航线策略、传感器配置及预警阈值，快速复用。
  * 任务可设优先级、计划执行时间窗、任务负责人，实现多角色协同。

* **航线规划**

  * 根据任务区域生成航线（栅格扫描、剖面飞行等简单策略）。
  * 将航线与任务一并下发给指定无人机。
  * 支持手动微调航点、禁飞区避让、地形跟随、高度/速度分段配置。
  * 航线版本管理：每次更新航线自动生成版本，可回滚、查看变更记录。

* **任务执行监控**

  * 查看任务进度：未开始、执行中、已完成、异常中止。
  * 支持强制终止、返航、暂停等控制命令。
  * 实时显示任务状态里程碑：起飞、到达作业区、采集完成、返航降落。
  * 异常任务自动推送：进度停滞、电量不足、失联等，支持分派处置人。
  * 任务完成后自动生成简报，包括飞行路径、数据量、告警摘要。

> 和无人机的数据交互关系：
> 任务/航线下发 → 协议里的 `StartMission` / `UploadMission`消息；
> 执行进度 → 协议里的 `MissionStatus` 上报。

---

#### 3.3 实时监测与预警模块

* **实时监测**

  * 多种数据实时显示：遥测、环境传感器数值（温度、湿度、PM、气体）、热成像伪彩图预览、可见光缩略图等。
  * 地图叠加显示：例如在地图瓦片上叠加网格数据（PM2.5、地表温度）。
  * 支持自定义大屏布局：卡片、曲线、仪表、热力层可拖拽组合。
  * 提供原始数据与平滑数据两种视图，方便判断波动是否异常。
  * 关键数据点可打标签（例如采样断点、返航点），后续用于历史回放。

* **预警规则配置**

  * 支持按场景配置阈值：

    * 森林火情：地表温度 > 某值 + 持续时间、视野内烟雾检测概率 > 某值；
    * 空气质量：PM2.5/某气体浓度超标；
    * 林业健康：植被指数NDVI持续低于正常范围。
  * AI 模型结果（如烟雾、火点、病虫害识别）触发预警。(后续补充)
  * 阈值可以分多级（提示/预警/警报），每级定义通知渠道（短信、APP、Webhook）。
  * 可定义组合条件：如“温度 > 60 且湿度 < 30 且电量 > 40”才触发返航建议。

* **告警管理**

  * 告警弹窗、地图标注告警点；
  * 告警记录查询、导出。
  * 告警支持确认/转派/关闭流程，记录处置意见及附件。
  * 每条告警与产生的数据帧、图像建立引用，便于复盘。

> 和协议的联系：
> 无人机侧做初步检测（比如热成像中的温度阈值），可以直接上报 `Alert` 消息；
> 或者原始/半处理数据上报后，平台侧进行二次分析再产生告警。

---

#### 3.4 数据采集与管理模块

* **通用数据模型**

  * 统一定义：遥测数据、标量传感器数据（气体/颗粒物/温湿度）、光学/多光谱/热成像图像数据、任务元数据。
  * 各数据模型包含基本字段（时间、坐标、数据来源、任务ID）以及场景专有字段（NDVI、气体浓度单位、分辨率）。
  * 数据质量标记：有效/缺失/异常，记录异常原因（通讯丢包、设备自检失败等）。
* **数据存储**

  * 结构化数据（遥测、传感器数值）存数据库；
  * 大文件（图像/视频）存文件存储/对象存储，数据库存索引和元数据。
  * 支持冷热数据分层：近3个月在主库，历史数据转冷存储但可按需拉回。
  * 具备数据压缩、去噪、坐标纠偏处理流程。
* **任务数据管理**

  * 按任务、场景、时间、区域检索数据；
  * 支持导出 CSV、GeoJSON、影像打包。
  * 提供数据快照：任务完成后锁定数据版本，保证后续分析可复现。
  * 开放 API/Token，用于科研人员批量下载或自动拉取数据集。

---

#### 3.5 分析与可视化模块

* **林业健康**

  * 基于多光谱数据计算NDVI等指标；
  * 生成植被指数热力图、病害疑似区域图层。
  * 支持多时相对比、差值图、自动生成巡检报告（含变化面积、严重程度）。

* **火情监测**

  * 热成像高温点提取，烟雾识别结果叠加地图；
  * 支持时间轴播放查看火情发展过程。
  * 火点轨迹推演与蔓延预测（简化版：依据风速/风向与历史温度梯度）。

* **城市热岛**

  * 地表温度分布图；
  * 不同时刻温度对比（工作日 vs 周末、昼夜对比）。
  * 与地面气象站数据联动，展示差异图层。

* **空气质量**

  * 垂直剖面曲线（高度 vs 浓度）、平面等值线图或热力图；
  * 多任务、多时间段对比分析。
  * 支持阈值带显示、数据极值自动标注。

* **土地利用变化**

  * 多时相影像对比，变化区域高亮显示。
  * 支持变化类型标注（林地→建设用地等），生成统计报表。
  * 变化结果可导出 GeoPackage，供 GIS 软件进一步处理。

---

#### 3.6 用户与权限管理

* 区分环保局用户与科研用户；
* 设置任务管理权限、告警处置权限、数据导出权限。
* 支持多租户/多区域隔离：不同地区可独立管理设备与数据。
* 登录支持账号密码 + 二次验证码。
* 提供操作审计日志：记录关键操作（下发任务、导出数据、删除数据）及原始参数。
* 角色自定义：可新增“数据标注员”、“模型训练账号”等细分角色。